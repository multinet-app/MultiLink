<!DOCTYPE html>

<meta charset="utf-8">
<title>MVN Survey</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<!-- <link rel="shortcut icon" href="favicon.ico" /> -->
<link rel="shortcut icon" href="#" />



<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/bulma.css">
<link rel="stylesheet" href="css/carousel-css.css">

<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>


<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.css"> -->

<!-- Adding Provenance and Experimentr Libraries  -->
<script src="libs/provenance.min.js"></script>
<script src="libs/experimentr.js"></script>

<!-- <script src="js/carousel-js.js"></script> -->

<filter id="shadow" x="0" y="0" width="200%" height="200%">
        <feDropShadow dx="40" dy="40" stdDeviation="35" flood-color="#ff0000" flood-opacity="1" />
      </filter>
      

<!-- <script src="https://d3js.org/d3.v5.min.js" type="text/javascript"></script> -->
<script src="libs/d3.min.js" type="text/javascript"></script>


<!-- Helper scripts to generate graphs and complete task Configurations -->
<!-- <script src="js/generateTwitterGraph.js" type="text/javascript"></script> -->
<script src="js/createTaskConfig.js" type="text/javascript"></script>


<body>
    <div class="hit" style=display:none>
        <nav class="navbar trialSection" role="navigation" id="trialBar" aria-label="main navigation">
            <p class="card-header-title">
                Get familiar with the visualization with the practice questions below. Your answers for these question
                are not part of the survey!
            </p>
        </nav>


        <div class="columns" id="visContent">
            <div id="targetSize">
                <div class="column ">
                    <div id="vis">
                        <div class="card" id="visPanel">
                            <div id="taskArea">
                                <div class="card taskCard">

                                    <p class="card-header-title">
                                        <span class="task">Task: </span><span class="taskText"> </span>
                                    </p>

                                </div>

                                <div class="card">
                                    <div class="card-content">
                                        <div class="content">
                                            <div >
                                                <!-- <label class="label">Search for Nodes</label> -->
                                                <input class="input searchInput" type="text"
                                                    placeholder="Search for node" id="search-input"></input>
                                                <a class="button is-pulled-right search" id="searchButton">Search</a>
                                                <p class='searchMsg errorMsg'></p>

                                                <a class="button" id="clear-selection">Clear Selections</a>

                                            </div>

                     

                                        </div>

                                    </div>


                                </div>
                                <div class="card">
                                    <header class="is-pulled-right card-header">
                                        <p class="card-header-title">
                                            <span class="helpIcon icon has-text-info">
                                                <i class="fas fa-lg fa-question-circle"></i> &nbsp
                                            </span> <strong>Help</strong>
                                        </p>
                                    </header>
                                    <div class="card-content">
                                        <div class="content">

                                            <svg id="legend-svg"></svg>
                                        </div>
                                    </div>
                                </div>


                                <div class="card answerHeader">
                                    <p class="card-header-title">
                                        <span class="answer">Answer </span>
                                    </p>

                                </div>

                                <div class="card answerCard">

                                    <div class="card-content">
                                        <div class="content">

                                            <a class="button is-pulled-right submit" id="submitButton"
                                                disabled>Submit</a>

                                            <span id="nodeAnswer">
                                                <label><strong>Selected Nodes</strong></label>
                                                <br />
                                                <ul id="selectedNodeList">
                                                    <li> test value</li>
                                                </ul>
                                                <p class='errorMsg' style=display:none></p>
                                                <br />

                                            </span>

                                            <span id="valueAnswer">
                                                <label><strong>Enter Answer Below</strong></label>
                                                <br />
                                                <input class="input" type="text" placeholder="answer text"
                                                    id="answerBox">
                                                <br />
                                                <p class='errorMsg' style=display:none></p>
                                            </span>
                                        </div>
                                    </div>

                                </div>

                            </div>

                            <div class="card" id="feedbackCard">
                                <div class="card-content">
                                    <div class="content">
                                        <span id="trialFeedback">
                                            <span class='errorMsg'>Try again.</span>
                                        </span>
                                    </div>
                                </div>


                            </div>

                            <div class="card taskMenu">
                                <header class="card-header">
                                    <p class="card-header-title">
                                        Task Shortcuts
                                    </p>

                                </header>
                                <div class="card-content">
                                    <div class="content">
                                            <!-- <article class="message is-link">
                                                    <div class="message-header">
                                                      <p>Link</p>
                                                      <button class="delete" aria-label="delete"></button>
                                                    </div>
                                                    <div class="message-body">
                                                      Lorem ipsum dolor sit amet, consectetur adipiscing elit. <strong>Pellentesque risus mi</strong>, tempus quis placerat ut, porta nec nulla. Vestibulum rhoncus ac ex sit amet fringilla. Nullam gravida purus diam, et dictum <a>felis venenatis</a> efficitur. Aenean ac <em>eleifend lacus</em>, in mollis lectus. Donec sodales, arcu et sollicitudin porttitor, tortor urna tempor ligula, id porttitor mi magna a neque. Donec dui urna, vehicula et sem eget, facilisis sodales sem.
                                                    </div>
                                                  </article> -->

                                    </div>
                                </div>

                            </div>


                            <div class="modal modalFeedback">
                                <div class="modal-background"></div>
                                <div class="modal-card">


                                    <header class="modal-card-head">
                                        <p class="modal-card-title">
                                            On a scale of 1 (easy) to 7 (hard), how hard was this task?
                                            <!-- Please rate the task and leave any feedback below: -->
                                        </p>
                                    </header>
                                    <section class="modal-card-body">
                                        <div class="content">

                                            <!-- <p><strong>  On a scale of 1 (easy) to 7 (hard), how hard was this task?</strong></p> -->


                                            <div class="control">

                                                <!-- <strong>easy</strong> -->
                                                easy

                                                <span id="easyHardRating">
                                                    <label class="radio">
                                                        <input type="radio" name="difficulty" value="1">
                                                        1
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="difficulty" value="2">
                                                        2
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="difficulty" value="3">
                                                        3
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="difficulty" value="4">
                                                        4
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="difficulty" value="5">
                                                        5
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="difficulty" value="6">
                                                        6
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="difficulty" value="7">
                                                        7
                                                    </label>

                                                </span>
                                                <!-- <strong>hard</strong> -->
                                                hard

                                            </div>
                                        </div>
                                    </section>

                                    <header class="modal-card-head">
                                        <p class="modal-card-title">
                                            On a scale of 1 (not confident) to 7 (confident),
                                            how <br /> confident are you with your answer?
                                        </p>
                                    </header>
                                    <section class="modal-card-body">
                                        <div class="content">

                                            <!-- <p><strong> On a scale of 1 (not confident) to 7 (confident), how confident are you with your answer?</strong></p> -->

                                            <div class="control">

                                                <!-- <strong>easy</strong> -->
                                                not confident

                                                <span id="easyHardRating">
                                                    <label class="radio">
                                                        <input type="radio" name="confidence" value="1">
                                                        1
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="confidence" value="2">
                                                        2
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="confidence" value="3">
                                                        3
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="confidence" value="4">
                                                        4
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="confidence" value="5">
                                                        5
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="confidence" value="6">
                                                        6
                                                    </label>
                                                    <label class="radio">
                                                        <input type="radio" name="confidence" value="7">
                                                        7
                                                    </label>

                                                </span>
                                                <!-- <strong>hard</strong> -->
                                                confident

                                            </div>
                                            <br />

                                            <p><strong>Enter any additional feedback in the text area below.</strong>
                                            </p>
                                            <textarea class="textarea"
                                                placeholder="Enter any additional information here"></textarea>

                                            <p class='errorMsg' style=display:none>Please select a rating for both
                                                difficulty and confidence before proceeding.</p>


                                        </div>
                                    </section>
                                    <footer class="modal-card-foot">
                                        <a href="#" id="nextTask" class="button is-pulled-right">Next Task</a>
                                    </footer>
                                </div>
                            </div>


                            <!-- Modal that shows a summary on vis interactions available -->
                            <div class="modal quickStart">
                                <div class="modal-background"></div>
                                <div class="modal-card">

                                    <section class="modal-card-body">
                                        <div class="content">

                                            <img src="" alt="">

                                        </div>
                                    </section>
                                    <footer class="modal-card-foot">
                                        <a href="#" id="closeModal" class="button is-pulled-right">Close</a>
                                    </footer>
                                </div>
                            </div>


                        </div>

                        <div class="nodeLink">
                            <svg id="node-link-svg"></svg>
                        </div>

                        <div class="adjMatrix vis">
                            <div class="loading"></div>
                            <div class="loadingOverlay"></div>
                            <div id="interactiveFreeFormMain">
                                <div id="topology" class="topocontainer" height="700" width="700"> </div>
                                <div id="attributes" class="attrcontainer" height="700" width="650"> </div>

                            </div>
                        </div>

                    </div>

                    <!-- <a class="button" id="panelControl">Hide/Show Control Panel</a> -->

                    <div class="development">
                        <!-- <a href="#" id="next" class="button is-pulled-right">Next Task</a>
                        <a href="#" id="previous" class="button is-pulled-right">Previous Task</a>


                        <a class="button condition is-pulled-right" id="saturatedConfig">10 Attribute Condition</a>
                        <a class="button condition is-pulled-right" id="nodeLinkConfig">5 Attribute Condition</a>
                        <a class="button condition is-pulled-right" id="optimalConfig">Optimal Condition</a> -->
                    </div>

                </div>

            </div>

            <!-- <div style="display:inline; padding-left: 20px;">
                                    <span><strong> Click the following button only once you are satisfied with your answer -> </strong></span>
                                    <span><button id="finished">Submit</button></span>
                                </div> -->
            <div class="column is-narrow development" id="panelDiv">

                <aside class="menu">




                    <!-- <p class="menu-label">
                                                Graph Settings
                                            </p> -->
                    <ul class="menu-list">

                        <li id="graphSize">
                            <label>Graph Size</label>

                            <ul>
                                <div class="control">
                                    <!-- <label class="radio">
                                                                            <input type="radio" name="graphSize" value="small" >
                                                                            Small [30]
                                                                        </label> -->

                                    <label class="radio">
                                        <input type="radio" name="graphSize" value="small">
                                        Small [50]
                                    </label>

                                    <label class="radio">
                                        <input type="radio" name="graphSize" value="large">
                                        Large [80]
                                    </label>
                                </div>

                            </ul>
                        </li>

                        <li>
                            <!-- Set config.isDirected to true/false -->
                            <a>Graph Type</a>
                            <ul>
                                <div class="control">
                                    <label class="radio">
                                        <input type="radio" name="isDirected" value="true">
                                        Directed
                                    </label>

                                    <label class="radio">
                                        <input type="radio" name="isDirected" value="false">
                                        Undirected
                                    </label>
                                </div>

                            </ul>


                        </li>

                        <li>
                            <!-- Set config.isMultiEdge to true/false -->
                            <a>Graph Edges</a>
                            <ul>
                                <div class="control">
                                    <label class="radio">
                                        <input type="radio" name="isMultiEdge" value="true">
                                        Multiple Types
                                    </label>

                                    <label class="radio">
                                        <input type="radio" name="isMultiEdge" value="false">
                                        Single Type
                                    </label>
                                </div>

                            </ul>


                        </li>

                        <li id="labelSize">
                            <label>Node Label Font Size</label>
                            <ul>
                                <div class="control is-inline-flex">
                                    <input class="slider" id="fontSlider" step="1" min="10" max="30" value="14"
                                        type="range">
                                    <output id="fontSliderValue">14</output> </div>
                            </ul>
                        </li>


                        <li id="nodeMarkerSize">
                            <label>Node Size [width,height]</label>
                            <ul>


                                <div class="control is-inline-flex">
                                    <input width="50%" id="markerSize" class="input" type="text"
                                        placeholder="width/height">
                                </div>

                            </ul>
                        </li>

                        <li>
                            <!-- Set config.isDirected to true/false -->
                            <a>Select Neighbors on Click</a>
                            <ul>
                                <div class="control">
                                    <label class="radio">
                                        <input type="radio" name="selectNeighbors" value="true">
                                        True
                                    </label>

                                    <label class="radio">
                                        <input type="radio" name="selectNeighbors" value="false">
                                        False
                                    </label>
                                </div>

                            </ul>


                        </li>


                        <ul class="menu-list">

                            <div style="padding-top: 30px; padding-bottom: 10px">

                                <a class="button" id="stop-simulation">Stop Simulation</a>
                                <a class="button" id="start-simulation">Restart Simulation</a>
                                <a class="button" id="release-nodes">Release Pinned Nodes</a>
                                <a class="button" id="exportGraph">Export Graph to Console</a>
                            </div>


                            <br />

                            <div class="field">
                                <input class="is-checkradio is-circle" id="renderBarsCheckbox" type="checkbox"
                                    name="renderBarsCheckbox" checked="checked">
                                <label for="renderBarsCheckbox">Render Nested Charts</label>
                            </div>


                            <li id="nodeQuantSelect">
                                <a>Attribute for Nested Quant Attributes (Bars)</a>
                                <ul>
                                </ul>
                            </li>

                            <br />

                            <li id="nodeCatSelect">
                                <a>Attribute for Nested Cat Attributes</a>
                                <ul>
                                </ul>
                            </li>


                            <li id="nodeQuantAttributes">
                                <a>Node Attribute Inspector</a>
                                <ul>
                                    <div class="select ">
                                        <select>
                                        </select>
                                    </div>

                                </ul>
                            </li>


                            <li id="nodeFillSelect">
                                <a>Attribute for Node Fill</a>
                                <ul>
                                    <div class="select">
                                        <select>
                                        </select>
                                    </div>

                                </ul>
                            </li>

                            <li id="nodeSizeSelect">
                                <a>Attribute for Node Size</a>
                                <ul>
                                    <div class="select">
                                        <select>
                                        </select>

                                    </div>

                                    <div class="control is-inline-flex">
                                        <input width="50%" class="input" type="text" placeholder="[min,max]">
                                    </div>

                                </ul>
                            </li>

                            <li id="edgeStrokeSelect">
                                <a>Attribute for Edge Stroke</a>
                                <ul>
                                    <div class="select">
                                        <select>
                                        </select>
                                    </div>

                                </ul>
                            </li>

                            <li id="edgeWidthSelect">
                                <a>Attribute for Edge Width</a>
                                <ul>
                                    <div class="select ">
                                        <select>
                                        </select>
                                    </div>

                                    <div class="control is-inline-flex">
                                        <input class="input" id="edgeWidthScale" type="text" placeholder="[min,max]">
                                    </div>

                                </ul>
                            </li>

                            <br />
                            <br />

                            <a class="button is-light" id="exportConfig">Export Task Config</a>

                            <br />

                            <a class="button is-light" id="exportBaseConfig">Export Base Config</a>


                </aside>
            </div>



        </div>
    </div>


    <div class="modal modalStartStudy">
        <div class="modal-background"></div>
        <div class="modal-card">


            <header class="modal-card-head">
                <p class="modal-card-title">
                    Ok, let's get started! <span style="font-size:14px"> (just a few quick notes before we jump in)
                        <span>
                </p>
            </header>
            <section class="modal-card-body">
                <div class="content">

                    <p>You will be presented with <strong>15 tasks</strong> in <em>random order of difficulty</em>. The
                        survey should take approximately 45 minutes to complete</p>

                    <p>After each task you will be asked to rate how hard the task was and how confident you are in your
                        answer. This information will help us
                        interpret the results more accurately.

                        <p>Any comments in the feedback box will also be helpful for us to understand what you found
                            particularly challenging or easy. </p>

                        <p> Remember you can always consult the <span class="icon has-text-info">
                                <i class="fas fa-lg fa-question-circle"></i> &nbsp
                            </span> <strong>Help</strong> button on the left panel to revisit the available interactions
                            and main encodings.</p>

                        <p> Let's get started! </p>


                </div>
            </section>

            <footer class="modal-card-foot">
                <a href="#" id="startSurvey" class="button is-pulled-right">Start Survey</a>
            </footer>
        </div>
    </div>
    
</body>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<!-- <script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-firestore.js"></script> -->

<script src="libs/firebase-app.js"></script>
<script src="libs/firebase-firestore.js"></script>


<script src="js/firebaseApi.js" type="text/javascript"></script>
<script src="js/loadTasks.js" type="text/javascript"></script>


<script>
    function getUrlVars() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&*#]*)/gi, function (m, key, value) {
            console.log(key, value)
            vars[key] = value;
        });
        return vars;
    }

    //set global variables such as vis type, whether to track userInteraction, if develop mode, etc... from url params
    var {
        vis,
        track,
        mode,
        shuffleTasks,
        taskMenu,
        configPanel,
        trials
    } = getUrlVars();

    mode = mode || 'heuristics'; //can be 'develop', 'test', 'heuristics', or 'study'

    //set default values for any variables not passed in and assign the appropriate database collections; 

    switch (mode) {
        case 'heuristics':
            track = true;
            shuffleTasks = shuffleTasks || false;
            taskMenu = taskMenu || false;;
            configPanel = false;
            trials = trials || false;
            break;
        case 'develop':
            track = track || true;
            shuffleTasks = shuffleTasks || false;
            taskMenu = taskMenu || true;
            configPanel = configPanel || false;
            trials = trials || true;
            break;
        case 'study':
            track = true;
            shuffleTasks = true;
            taskMenu = false;
            configPanel = false;
            trials = true;
            break;
        case 'test':
            track = track || true;
            shuffleTasks = shuffleTasks || true;
            taskMenu = taskMenu || true;
            configPanel = configPanel || false;
            trials = trials || true;
            break;
    }

    track = eval(track);
    shuffleTasks = eval(shuffleTasks);
    taskMenu = eval(taskMenu);
    configPanel = eval(configPanel);
    trials = eval(trials);

    participantCollection = mode + '_participants';

    //remove ui components that are not relevant
    if (!configPanel) {
        d3.selectAll('.development').remove();
    }

    if (!taskMenu) {
        d3.select('.taskMenu').remove();
    }


    //connect to firestore;
    fireStore.connect();

    let sequence;

    switch (mode) {
        case 'heuristics':
            workerID = makeid(6);
            break;
        case 'develop':
            workerID = 'DevelopUser';
            break;
        case 'test':
            workerID = 'TestUser';
            break;
    }

 

    //set up  user on firestore to track answers and usage;
    if (track) {

        if (mode !== 'study') {

               //start tracking user interaction with study_provenance
                setUpStudyProvenance(mode + ' - started');

            let screenSize = {
                availWidth: window.screen.availWidth,
                availHeight: window.screen.availHeight,
                width: window.screen.width,
                height: window.screen.height,
                colorDepth: window.screen.colorDepth,
                pixelDepth: window.screen.pixelDepth
            };

            db.collection(participantCollection).doc(workerID).set({
                screenSize,
                completionCode: makeid(6),
                startTime:new Date().toString()
            }, {
                merge: true
            });
        }
    }


    switch (mode) {
        case 'heuristics':
            sequence = [
                'modules/hit.html',
                'modules/submit.html'
            ];
            break;
        case 'study':
            sequence = [
                'modules/consent.html',
                'modules/training.html',
                'modules/trials.html',
                'modules/hit.html',
                'modules/submit.html'
            ]
            break;
        case 'test':

            sequence = ['modules/training.html'];

            sequence = trials ? sequence.concat(['modules/trials.html']) : sequence;

            sequence = sequence.concat([
                'modules/hit.html',
                'modules/submit.html'
            ])
            break;
        case 'develop':

            sequence = trials ? ['modules/trials.html'] : [];

            sequence = sequence.concat([
                'modules/hit.html',
                'modules/submit.html'
            ])
    }

    experimentr.sequence(sequence).start();
</script>
